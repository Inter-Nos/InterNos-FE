# E2E 테스트 시나리오

Inter Nos 프론트엔드 주요 기능에 대한 E2E 테스트 시나리오입니다.

## 환경 설정

- 테스트 도구: Cypress 또는 Playwright
- 브라우저: Chrome (모바일 뷰포트 480px)
- API: Mock 서버 또는 개발 환경

## 시나리오

### 1. 인증 플로우

#### 1.1 사용자 가입 및 로그인

1. `/login` 페이지 접근
2. "가입" 탭 선택
3. 사용자명 입력 (2-20자, 영문/숫자/언더스코어)
4. 비밀번호 입력 (8자 이상)
5. "가입" 버튼 클릭
6. 성공 시 `/dashboard`로 리다이렉트 확인
7. CSRF 토큰이 Zustand 스토어에 저장되었는지 확인

#### 1.2 로그인 실패 처리

1. `/login` 페이지 접근
2. 잘못된 사용자명/비밀번호 입력
3. "로그인" 버튼 클릭
4. 에러 메시지 표시 확인 (401 에러)
5. 레이트리밋 시도 시 429 에러 및 Retry-After 표시 확인

### 2. 방 생성 및 이미지 업로드

#### 2.1 TEXT 방 생성

1. 로그인 후 `/create` 페이지 접근
2. 제목, 힌트, 정답 입력
3. 콘텐츠 타입 "텍스트" 선택
4. 콘텐츠 텍스트 입력
5. 정책 "1회" 선택
6. "방 만들기" 버튼 클릭
7. 성공 시 ShareModal 표시 확인
8. 공유 링크 복사 기능 확인

#### 2.2 IMAGE 방 생성

1. `/create` 페이지 접근
2. 콘텐츠 타입 "이미지" 선택
3. 이미지 파일 선택 (jpg/png/webp, ≤10MB)
4. 이미지 미리보기 확인
5. "업로드" 버튼 클릭
6. 업로드 진행률 표시 확인
7. 업로드 완료 후 폼 제출
8. presign → PUT → fileRef 저장 흐름 확인

#### 2.3 이미지 업로드 실패 처리

1. 10MB 이상 파일 선택 시 에러 메시지 확인
2. 지원하지 않는 파일 형식 선택 시 에러 확인
3. 업로드 실패 시 재시도 UI 확인

### 3. 공개 방 목록 및 탐색

#### 3.1 방 목록 조회

1. `/rooms` 페이지 접근
2. 기본 "트렌딩" 탭 확인
3. 방 카드들이 로드되는지 확인
4. 카드에 제목, 힌트, 작성자명, 시도/성공률 표시 확인

#### 3.2 정렬 기능

1. "최신" 탭 클릭
2. 목록이 최신순으로 정렬되는지 확인
3. "어려운" 탭 클릭
4. 목록이 어려운 순으로 정렬되는지 확인

#### 3.3 무한 스크롤

1. 목록 스크롤 다운
2. "더 보기" 버튼 또는 자동 로딩 확인
3. 다음 페이지 방들이 추가로 로드되는지 확인
4. cursor 기반 페이지네이션 동작 확인

### 4. 방 풀이 플로우

#### 4.1 TEXT 방 풀이 성공

1. `/s/{id}` 페이지 접근
2. Solve 메타 로드 확인 (힌트, 정책, 남은 횟수)
3. 정답 입력
4. "정답 제출" 버튼 클릭
5. nonce 발급 → solve 요청 흐름 확인
6. 성공 시 텍스트 콘텐츠 표시 확인

#### 4.2 IMAGE 방 풀이 성공

1. IMAGE 타입 방 페이지 접근
2. 정답 입력 및 제출
3. 성공 시 signedUrl이 즉시 `<img>` 태그에 바인딩되는지 확인
4. 이미지가 프리패치되지 않고 제출 성공 시에만 로드되는지 확인

#### 4.3 오답 처리 및 락아웃

1. 잘못된 정답 5회 입력
2. 423 LOCKED 에러 응답 확인
3. Retry-After 헤더 파싱 확인
4. 카운트다운 타이머 표시 확인
5. 잠금 상태에서 정답 입력 폼 비활성화 확인
6. 카운트다운 종료 후 자동으로 메타 재로드 확인

#### 4.4 레이트리밋 처리

1. 빠르게 여러 번 solve 요청
2. 429 RATE_LIMITED 에러 확인
3. Retry-After 기반 쿨다운 메시지 표시 확인

#### 4.5 만료/정책 소진 처리

1. 만료된 방 또는 정책 소진된 방 접근
2. 410 GONE 에러 확인
3. 안내 메시지 및 "공개 방 보러가기" CTA 확인

### 5. 비공개 방 접근

1. 비공개 방 URL 직접 접근 (권한 없음)
2. 404 에러 응답 확인
3. "존재하지 않거나 접근할 수 없는 방입니다." 메시지 확인
4. 존재 여부가 은닉되었는지 확인

### 6. 대시보드

#### 6.1 KPI 조회

1. `/dashboard` 페이지 접근
2. 24h/7d/전체 범위 선택기 확인
3. 각 KPI 카드가 올바르게 표시되는지 확인
4. 스파크라인 그래프 표시 확인

#### 6.2 내 방 관리

1. 내 방 목록 표시 확인
2. 방 카드 액션 버튼 (공유, 삭제) 확인
3. 공유 버튼 클릭 시 ShareModal 표시 확인
4. 삭제 버튼 클릭 시 확인 다이얼로그 표시
5. 삭제 후 목록에서 제거 확인

### 7. CSRF 토큰 처리

1. 페이지 로드 시 `GET /auth/session` 호출 확인
2. CSRF 토큰이 Zustand 스토어에 저장되는지 확인
3. POST/PATCH/DELETE 요청 시 `X-CSRF-Token` 헤더 자동 첨부 확인
4. 로그인 성공 후 CSRF 토큰 갱신 확인

### 8. 보안 검증

1. 브라우저 개발자 도구에서 민감 정보(비밀번호, 정답) 로깅 확인
2. 서명 URL이 메모리/로컬 스토리지에 저장되지 않는지 확인
3. 이미지 URL이 프리패치되지 않는지 네트워크 탭 확인

## 체크리스트

- [ ] 모든 인증 플로우 정상 동작
- [ ] 방 생성 (TEXT/IMAGE) 정상 동작
- [ ] 이미지 업로드 흐름 정상 동작
- [ ] 공개 방 목록 및 정렬 정상 동작
- [ ] Solve 플로우 (TEXT/IMAGE) 정상 동작
- [ ] 에러 처리 (423/429/410/404) 정상 동작
- [ ] CSRF 토큰 처리 정상 동작
- [ ] Retry-After 헤더 파싱 및 카운트다운 정상 동작
- [ ] 서명 URL 프리패치 금지 확인
- [ ] 민감 정보 로깅 금지 확인

